# 文件持久化说明

## Railway平台限制

Railway使用临时文件系统，每次部署时会重置。这意味着：

1. **静态文件会丢失**：`static/uploads/` 和 `static/files/` 中的文件会在部署后消失
2. **数据库文件保留**：`data.json`、`files.json` 等会被Git追踪，会保留

## 解决方案

### 已实现的持久化机制

#### 1. 文件元数据持久化
所有文件的信息（文件名、大小、上传时间、下载次数等）保存在：
- `files.json` - 文件资源元数据
- `data.json` - 头像、背景图等文件URL

#### 2. 重要文件使用固定文件名
- 头像：`avatar.{ext}` - 每次上传会替换旧文件
- 自定义鼠标：`cursor_{uuid}.{ext}`

### 文件恢复流程

部署后如果文件丢失，系统会：

1. **显示占位图**：前端会使用 `via.placeholder.com` 作为占位
2. **保留元数据**：文件信息仍然在数据库中
3. **提示重新上传**：用户需要重新上传文件

### 最佳实践

1. **定期备份**：重要文件请下载到本地保存
2. **使用外部存储**：建议使用阿里云OSS、腾讯云COS等永久存储
3. **版本控制**：重要配置通过Git管理

### 未来改进建议

如果需要真正的文件持久化，建议：

1. **集成云存储服务**：
   - 阿里云OSS
   - 腾讯云COS
   - AWS S3

2. **使用Railway Volume**（付费功能）：
   - 持久化磁盘存储
   - 数据在部署后保留

3. **使用外部数据库**：
   - MongoDB Atlas
   - PostgreSQL
   - MySQL

## 当前状态

- ✅ 文件元数据持久化（保存在JSON文件中）
- ✅ 重要文件URL保存在data.json
- ⚠️  物理文件会在部署后丢失
- ⚠️  需要用户重新上传文件